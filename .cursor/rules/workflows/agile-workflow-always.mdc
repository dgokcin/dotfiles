---
description: Must ALWAYS follow the steps outlined in this workflow to complete the project or goals of the user
globs: .ai/**/*.md
alwaysApply: true
---

# Agile Workflow Protocol

## Context

- Managing project documentation and progress
- Ensuring consistent development process
- Maintaining project memory and history

## Critical Rules

- Use templates from `.cursor/templates/` for new documents
- Verify/create `.ai/prd.md` using `prd-manual.mdc` template
- Document architecture using `arch-manual.mdc` template
- Create stories using `story-manual.mdc` template
- Follow TDD with 80% test coverage
- Track lessons learned
- Update story files as work progresses

### Required File Structure

```
.cursor/
├── templates/           # Document Templates
│   ├── arch-manual.mdc  # Architecture template
│   ├── prd-manual.mdc   # PRD template
│   └── story-manual.mdc # Story template
.ai/
├── prd.md              # Product Requirements
├── arch.md             # Architecture
├── arch/               # Architecture Decisions
│   └── {n}-descriptive-decision-name.md
├── epics/              # Epics
│   ├── epic-{n}-descriptive-epic-name/     # Example: epic-1-user-authentication/
│   │   ├── story-{m}-descriptive-story-name.md  # Example: story-1-oauth-setup.md
│   │   └── story-{m}-descriptive-story-name.md  # Example: story-2-user-roles.md
│   │   └── story-{m}-descriptive-story-name.md  # Example: story-3-user-roles.md
│   └── epic-{n}-descriptive-epic-name/     # Example: epic-2-payment-processing/
└── lessons/           # Lessons Learned
    └── YYYY-MM-DD-descriptive-lesson-name.md
```

### Workflow Steps

1. Verify/create PRD
2. Create/update architecture docs
3. Create story files
4. Implement with TDD
5. Document decisions/lessons
6. Update progress regularly

## Examples

<example>
# Project Initialization

1. Create PRD:
```markdown
# Project Requirements

## Purpose
Develop inventory management system

## Architecture
[Diagram and patterns]

## Technologies
- Node.js v18
- PostgreSQL
- Redis
```

2. Create Story:
```markdown
# Story-1-project-setup: Initial Project Configuration

## Tasks
- [ ] Initialize project structure
- [ ] Configure development environment
- [ ] Set up database schema
- [ ] Implement basic CI/CD pipeline
```
</example>

<example type="invalid">
Started coding without PRD
No tests written
Missing documentation
[Violates TDD and documentation requirements]
</example>